-- SQL_REPORT_SAISYUTSURYOKU
SELECT a.管理No,c.作業区コード,COALESCE(d.作業区名,'') AS 作業区名,a.発注日,c.納期,e.品番,e.設変番号,e.品名,e.受注番号,e.枝番,c.工程コード,COALESCE(f.工程名,'') AS 工程名,COALESCE(h.作業区名,'') AS 前工程作業区名,g.納期 AS 前工程納期,CASE WHEN i.作業区コード IS NULL THEN '古河（本社）' ELSE COALESCE(j.作業区名,'') END AS 次工程作業区名,a.伝票番号,b.生産数 AS 発注数,e.単位,CASE WHEN c.加工費区分 = true OR c.材料費区分 = true THEN 0.00 ELSE c.加工費 + c.材料費 END AS 発注単価 ,CASE WHEN c.加工費区分 = true OR c.材料費区分 = true THEN 0 ELSE CAST(trunc((c.加工費 + c.材料費) * b.生産数 ,0) as BIGINT) END AS 発注金額 ,e.発注備考1,e.発注備考2,COALESCE(k.社員名,'') AS 担当者名,CASE WHEN l.品番 IS NULL THEN '0' ELSE '1' END AS 管理マーク,CASE WHEN e.受注区分 <> '4' THEN '0' ELSE '1' END AS 再納マーク,CASE e.再納区分 WHEN '1' THEN '不合格選別依頼' WHEN '2' THEN '不合格再処理' WHEN '3' THEN '不合格再製造' ELSE '' END AS 再納マーク種類 FROM T_発注 AS a INNER JOIN T_生産計画 AS b ON b.管理No = a.管理No INNER JOIN T_生産計画詳細 AS c ON c.管理No = a.管理No AND c.工程順序No = a.工程順序No LEFT OUTER JOIN M_作業区仕入先 AS d ON d.作業区コード = c.作業区コード INNER JOIN T_受注 AS e ON e.管理No = a.管理No LEFT OUTER JOIN M_工程 AS f ON f.工程コード = c.工程コード LEFT OUTER JOIN T_生産計画詳細 AS g ON g.管理No = a.管理No AND g.工程順序No = (a.工程順序No - 1) LEFT OUTER JOIN M_作業区仕入先 AS h ON h.作業区コード = g.作業区コード LEFT OUTER JOIN T_生産計画詳細 AS i ON i.管理No = a.管理No AND i.工程順序No = (a.工程順序No + 1) LEFT OUTER JOIN M_作業区仕入先 AS j ON j.作業区コード = i.作業区コード LEFT OUTER JOIN M_社員 AS k ON k.社員コード = e.担当者コード LEFT OUTER JOIN ( SELECT DISTINCT 品番 FROM T_図面 WHERE 図面種類 = '1' ) AS l ON l.品番 = e.品番 WHERE a.管理No = CAST(? AS INT) AND a.工程順序No = CAST(? AS INT) ORDER BY a.管理No, a.工程順序No
