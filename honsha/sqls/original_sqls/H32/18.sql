-- SQL_GET_CUSTOMER
SELECT * FROM ( SELECT CASE WHEN x.管理No IS NOT NULL THEN x.管理No ELSE y.管理No END AS 管理No ,CASE WHEN x.分納No IS NOT NULL THEN X.分納No ELSE y.分納No END AS 分納No ,x.回答日種別 ,x.回答日 ,x.回答日色区分 ,x.予定納入数 ,y.納入日 ,y.納入数 ,x.納入依頼日 ,y.出荷区分 ,y.検査出荷依頼日 ,y.検査完了日 ,y.検査出荷依頼数 FROM ( SELECT CASE WHEN a.管理No IS NOT NULL THEN a.管理No ELSE b.管理No END AS 管理No ,CASE WHEN a.分納No IS NOT NULL THEN a.分納No ELSE b.分納No END AS 分納No ,CASE COALESCE(a.回答日区分,'') WHEN '1' THEN '営回' WHEN '2' THEN '営発' WHEN '3' THEN '客回' WHEN '4' THEN '客発' ELSE '' END AS 回答日種別 ,a.回答日 ,CASE COALESCE(a.回答日区分,'') WHEN '1' THEN '0' /* 営回(black) */ WHEN '2' THEN '0' /* 営発(black) */ WHEN '3' THEN '2' /* 客回(blue) */ WHEN '4' THEN '1' /* 客発(red) */ ELSE '0' END AS 回答日色区分 ,a.予定納入数 ,b.依頼日 AS 納入依頼日 FROM T_納期回答 AS a FULL OUTER JOIN T_納入依頼 AS b ON b.管理No = a.管理No AND b.分納No = a.分納No ) AS x FULL OUTER JOIN ( SELECT CASE WHEN c.管理No IS NOT NULL THEN c.管理No ELSE d.管理No END AS 管理No ,CASE WHEN c.分納No IS NOT NULL THEN c.分納No ELSE d.分納No END AS 分納No ,CASE COALESCE(c.出荷区分,'') WHEN '1' THEN '振替出荷' WHEN '2' THEN '在庫出荷' WHEN '3' THEN '通常出荷' ELSE '' END AS 出荷区分 ,c.依頼日 AS 検査出荷依頼日 ,c.依頼数 AS 検査出荷依頼数 ,c.結果登録日 AS 検査完了日 ,d.納入日 ,d.依頼数 AS 納入数 FROM T_検査出荷依頼 AS c FULL OUTER JOIN T_売上 AS d ON d.管理No = c.管理No AND d.分納No = c.分納No ) AS y ON y.管理No = x.管理No AND y.分納No = x.分納No ) AS z WHERE z.管理No = CAST(? as INT) ORDER BY z.分納No


