-- SQL_GET_COPY
SELECT a.管理No ,a.受注番号 ,a.枝番 ,a.得意先コード ,COALESCE(b.得意先名,'') AS 得意先名 ,a.品番 ,a.設変番号 ,a.品名 ,a.担当者コード ,COALESCE(c.社員名,'') AS 担当者名 ,CASE a.受注区分 WHEN '1' THEN '先行手配' WHEN '2' THEN '受注' WHEN '3' THEN '受注' WHEN '4' THEN '再納' ELSE '' END AS 受注区分 ,CASE a.再納区分 WHEN '1' THEN '選別依頼' WHEN '2' THEN '再処理' WHEN '3' THEN '再製造' ELSE '' END AS 再納区分 ,a.受注数 ,a.受注日 ,a.納期 AS 客先納期 ,a.単価 ,COALESCE(d.在庫数,0) AS 在庫数 ,COALESCE(d.仮受在庫数,0) AS 仮受在庫数 ,COALESCE(d.在庫数,0) - COALESCE(d.出荷依頼数,0) AS 有効在庫数 ,CASE WHEN COALESCE(e.材料費変動補正対象,false) = true THEN COALESCE(e.材質ベース単価,0) ELSE 0 END AS 材質ベース単価（基本） ,CASE WHEN COALESCE(e.材料費変動補正対象,false) = true THEN COALESCE(e.材料費,0) ELSE 0 END AS 材料費（基本） ,CASE WHEN COALESCE(e.材料費変動補正対象,false) = true THEN COALESCE(f.材質ベース単価,0) ELSE 0 END AS 材質ベース単価 ,a.受注数 AS 生産数 ,0 AS バージョン番号 ,'0' AS 発注状況 ,h.工程順序No ,h.作業区コード ,COALESCE(i.作業区略称,'') AS 作業区名 ,h.工程コード ,COALESCE(j.工程略称,'') AS 工程名 ,h.リードタイム ,NULL AS 納期 ,CASE WHEN h.次回加工費 <> 0 THEN h.次回加工費 + h.材料費 ELSE h.加工費 + h.材料費 END AS 発注単価 ,h.加工費区分 ,CASE WHEN h.次回加工費 <> 0 THEN h.次回加工費 ELSE h.加工費 END AS 加工費 ,h.材料費区分 ,h.材料費 ,0 AS 詳細バージョン番号 ,e.材料費変動補正対象 ,CASE WHEN COALESCE(e.材料費変動補正対象,false) = true THEN COALESCE(e.材料費補正額,0) ELSE 0 END AS 材料費補正額 ,0 AS 次回加工費 FROM T_受注 AS a LEFT OUTER JOIN M_得意先 AS b ON b.得意先コード = a.得意先コード LEFT OUTER JOIN M_社員 AS c ON c.社員コード = a.担当者コード LEFT OUTER JOIN M_在庫 AS d ON d.品番 = a.品番 AND d.設変番号 = a.設変番号 LEFT OUTER JOIN M_部品 AS e ON e.品番 = a.品番 LEFT OUTER JOIN M_材質ベース単価 AS f ON f.材質コード = e.材質コード AND CURRENT_DATE BETWEEN f.適用開始日 AND f.適用終了日 CROSS JOIN T_生産計画 AS g INNER JOIN T_生産計画詳細 AS h ON h.管理No = g.管理No LEFT OUTER JOIN M_作業区仕入先 AS i ON i.作業区コード = h.作業区コード LEFT OUTER JOIN M_工程 AS j ON j.工程コード = h.工程コード WHERE a.管理No = CAST(? AS INT) AND g.管理No = CAST(? AS INT) ORDER BY h.工程順序No


