-- SQL_GET_TEISEI_CORE
SELECT a.管理No,a.分納No,b.受注番号,b.枝番,b.得意先コード,COALESCE(c.得意先名,'') AS 得意先名,CASE WHEN b.得意先コード = '1' THEN '1' ELSE '0' END AS 得意先区分,b.品番,b.設変番号,b.品名,b.客先品番,b.担当者コード,COALESCE(d.社員名,'') AS 担当者名,CASE b.注文データ区分 WHEN 'A' THEN COALESCE(e.管理番号,'') WHEN 'K' THEN COALESCE(f.管理番号,'') WHEN 'C' THEN COALESCE(f.管理番号,'') ELSE ''END AS 管理番号 ,b.請求元,CASE b.注文データ区分 WHEN 'A' THEN COALESCE(e.工号,'') WHEN 'K' THEN COALESCE(f.工号,'') WHEN 'C' THEN COALESCE(f.工号,'') ELSE ''END AS 工号,CASE b.注文データ区分 WHEN 'A' THEN COALESCE(e.棚番,'') WHEN 'K' THEN COALESCE(f.棚番,'') WHEN 'C' THEN COALESCE(f.棚番,'') ELSE ''END AS 棚番,b.受注日,b.納期,a.納入日,b.受注数,g.依頼数,CASE a.納入形態区分 WHEN '1' THEN '完納' WHEN '2' THEN '打切り' WHEN '3' THEN '分納' WHEN '4' THEN '過剰納入' WHEN '11' THEN 'END' WHEN '12' THEN 'STP' WHEN '13' THEN 'ING' ELSE ''END AS 納入形態,a.依頼数 AS 納入数,b.単位,b.単価,CASE COALESCE(c.金額端数処理区分,'1') WHEN '1' THEN CAST(FLOOR(b.単価 * a.依頼数) as BIGINT) WHEN '2' THEN CAST(CEIL(b.単価 * a.依頼数) as BIGINT) ELSE CAST(ROUND(b.単価 * a.依頼数, 0) as BIGINT)END AS 金額,b.次工程名,g.納入場所名,a.現品票備考,a.備考1,a.備考2,a.梱包単位,a.バージョン番号,a.納入形態区分,h.SeqNo,h.個数,h.梱包数 FROM T_売上 AS a INNER JOIN T_受注 AS b ON b.管理No = a.管理No LEFT OUTER JOIN M_得意先 AS c ON c.得意先コード = b.得意先コード LEFT OUTER JOIN M_社員 AS d ON d.社員コード = b.担当者コード LEFT OUTER JOIN T_購買伝票受注 AS e ON e.帳票番号 = b.注文バーコード番号 LEFT OUTER JOIN T_工号生産納入指示 AS f ON f.発行連番 = b.注文バーコード番号 INNER JOIN T_検査出荷依頼 AS g ON g.管理No = a.管理No AND g.分納No = a.分納No INNER JOIN T_売上詳細 AS h ON h.管理No = a.管理No AND h.分納No = a.分納No WHERE a.管理No = CAST(? as INT) AND a.分納No = CAST(? as INT) ORDER BY h.SeqNo


