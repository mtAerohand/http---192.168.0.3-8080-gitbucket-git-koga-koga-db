-- SQL_REPORT_42_COUNT_TEMPLATE
SELECT CAST(COUNT(A.作業区コード) AS INT) %s %s
-- SQL_REPORT_42_COMMON(%s1)
FROM ( SELECT x.作業区コード ,CAST(COUNT(x.作業区コード) AS INT) AS 件数 ,SUM(x.仕入金額) AS 仕入金額 FROM ( SELECT b1.作業区コード ,a1.金額 AS 仕入金額 FROM T_工程受入 AS a1 INNER JOIN T_発注 AS b1 ON b1.伝票番号 = a1.伝票番号 WHERE a1.受入日 BETWEEN CAST(CASE WHEN ? = '' THEN '2000-01-01' ELSE ? END as DATE) AND CAST(CASE WHEN ? = '' THEN '9999-12-31' ELSE ? END as DATE) UNION ALL SELECT a2.作業区コード ,- a2.金額 AS 仕入金額 FROM T_受入返品 AS a2 WHERE a2.返品日 BETWEEN CAST(CASE WHEN ? = '' THEN '2000-01-01' ELSE ? END as DATE) AND CAST(CASE WHEN ? = '' THEN '9999-12-31' ELSE ? END as DATE) UNION ALL SELECT a3.仕入先コード AS 作業区コード ,CASE WHEN a3.取引区分 = '1' THEN a3.金額 ELSE - a3.金額 END AS 仕入金額 FROM T_仕入 AS a3 WHERE a3.取引日 BETWEEN CAST(CASE WHEN ? = '' THEN '2000-01-01' ELSE ? END as DATE) AND CAST(CASE WHEN ? = '' THEN '9999-12-31' ELSE ? END as DATE) UNION ALL SELECT a4.支給先コード AS 作業区コード ,CASE WHEN a4.取引区分 = '1' AND a4.相殺方法 = '1' THEN - a4.支給金額 WHEN a4.取引区分 = '1' AND a4.相殺方法 = '2' THEN - c4.相殺金額 ELSE a4.支給金額 END AS 仕入金額 FROM T_仕入 AS a4 LEFT OUTER JOIN T_仕入相殺 AS c4 ON c4.SeqNo = a4.SeqNo WHERE a4.取引分類 = '1' AND CASE WHEN a4.取引区分 = '1' AND a4.相殺方法 = '2' THEN c4.相殺日 ELSE a4.取引日 + interval'1 month' END BETWEEN CAST(CASE WHEN ? = '' THEN '2000-01-01' ELSE ? END as DATE) AND CAST(CASE WHEN ? = '' THEN '9999-12-31' ELSE ? END as DATE) UNION ALL SELECT a5.取引先コード AS 作業区コード ,- a5.金額 AS 仕入金額 FROM T_売上任意 AS a5 WHERE a5.取引先区分 = '2' AND a5.売上日 BETWEEN CAST(CASE WHEN ? = '' THEN '2000-01-01' ELSE ? END as DATE) AND CAST(CASE WHEN ? = '' THEN '9999-12-31' ELSE ? END as DATE) ) AS x GROUP BY x.作業区コード ) AS A LEFT OUTER JOIN M_作業区仕入先 AS B ON B.作業区コード = A.作業区コード
    -- SQL_REPORT_42_ORDERBY(%s2)
    ORDER BY COALESCE(B.表示順,0), B.作業区コード


