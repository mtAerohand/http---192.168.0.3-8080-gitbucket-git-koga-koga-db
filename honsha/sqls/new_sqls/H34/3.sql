-- SQL_GET_ALL_SELECT
SELECT x.management_no ,x.supplier_code ,COALESCE(y.supplier_abbreviation,'') AS supplier_name ,x.supplier_manager_name ,z.incoming_order_no ,z.branch_no ,z.part_no ,z.engineering_change_no ,CASE WHEN x.request_report_type = '1' THEN COALESCE(t.process_abbreviation,'') ELSE COALESCE(t.process_abbreviation,'') || ' 他' END AS process_name ,x.requested_delivery_DATE ,x.contact_method_type ,CASE WHEN x.contact_method_type = '1' THEN 'メール' ELSE 'Fax' END AS contact_method_type名 ,x.request_report_type ,CASE WHEN x.request_report_type = '1' THEN '' ELSE '多工程' END AS request_report_type名
-- SQL_GET_ALL_FROM
FROM ( /* 通常 */ SELECT b.management_no ,b.process_sort_no ,b.supplier_code ,b.supplier_manager_name ,b.requested_delivery_DATE ,b.contact_method_type ,b.request_report_type ,b.manager_code FROM ( SELECT management_no ,process_sort_no ,MIN(partial_delivery_no) AS 先頭partial_delivery_no FROM t_deadline_response_requests WHERE has_response_request = true AND request_report_type = '1' GROUP BY management_no, process_sort_no ) AS a INNER JOIN t_deadline_response_requests AS b ON b.management_no = a.management_no AND b.process_sort_no = a.process_sort_no AND b.partial_delivery_no = a.先頭partial_delivery_no UNION ALL /* 多工程 */ SELECT c.management_no ,c.process_sort_no ,c.supplier_code ,c.supplier_manager_name ,c.requested_delivery_DATE ,c.contact_method_type ,c.request_report_type ,c.manager_code FROM ( SELECT management_no ,MIN(process_sort_no) AS 先頭process_sort_no FROM t_deadline_response_requests WHERE has_response_request = true AND request_report_type = '2' GROUP BY management_no ) AS a INNER JOIN ( SELECT management_no ,process_sort_no ,MIN(partial_delivery_no) AS 先頭partial_delivery_no FROM t_deadline_response_requests WHERE has_response_request = true AND request_report_type = '2' GROUP BY management_no, process_sort_no ) AS b ON b.management_no = a.management_no AND b.process_sort_no = a.先頭process_sort_no INNEr JOIN t_deadline_response_requests AS c ON c.management_no = b.management_no AND c.process_sort_no = b.process_sort_no AND c.partial_delivery_no = b.先頭partial_delivery_no ) AS x LEFT OUTER JOIN m_suppliers AS y ON y.supplier_code = x.supplier_code INNER JOIN t_incoming_orders AS z ON z.management_no = x.management_no INNER JOIN t_production_plan_details AS s ON s.management_no = x.management_no AND s.process_sort_no = x.process_sort_no LEFT OUTER JOIN m_processes AS t ON t.process_code = s.process_code WHERE x.manager_code = ?
-- SQL_GET_ALL_ORDER
ORDER BY COALESCE(y.sort_no,0), x.supplier_code, x.supplier_manager_name, x.requested_delivery_DATE, z.part_no


