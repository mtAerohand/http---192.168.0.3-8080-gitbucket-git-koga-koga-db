-- SQL_GET_COPY
SELECT a.management_no ,a.incoming_order_no ,a.branch_no ,a.customer_code ,COALESCE(b.customer_name,'') AS customer_name ,a.part_no ,a.engineering_change_no ,a.part_name ,a.manager_code ,COALESCE(c.employee_name,'') AS manager_name ,CASE a.incoming_order_type WHEN '1' THEN '先行手配' WHEN '2' THEN '受注' WHEN '3' THEN '受注' WHEN '4' THEN '再納' ELSE '' END AS incoming_order_type ,CASE a.redelivery_type WHEN '1' THEN '選別依頼' WHEN '2' THEN '再処理' WHEN '3' THEN '再製造' ELSE '' END AS redelivery_type ,a.incoming_order_quantity ,a.incoming_order_DATE ,a.deadline AS 客先deadline ,a.unit_price ,COALESCE(d.stock_quantity,0) AS stock_quantity ,COALESCE(d.suspense_stock_quantity,0) AS suspense_stock_quantity ,COALESCE(d.stock_quantity,0) - COALESCE(d.ship_request_quantity,0) AS 有効stock_quantity ,CASE WHEN COALESCE(e.is_corrected_material_cost,false) = true THEN COALESCE(e.material_basic_unit_price,0) ELSE 0 END AS material_basic_unit_price（基本） ,CASE WHEN COALESCE(e.is_corrected_material_cost,false) = true THEN COALESCE(e.material_cost,0) ELSE 0 END AS material_cost（基本） ,CASE WHEN COALESCE(e.is_corrected_material_cost,false) = true THEN COALESCE(f.material_basic_unit_price,0) ELSE 0 END AS material_basic_unit_price ,a.incoming_order_quantity AS production_quantity ,0 AS version_no ,'0' AS 発注状況 ,h.process_sort_no ,h.supplier_code ,COALESCE(i.supplier_abbreviation,'') AS supplier_name ,h.process_code ,COALESCE(j.process_abbreviation,'') AS process_name ,h.lead_time ,NULL AS deadline ,CASE WHEN h.next_manufacture_cost <> 0 THEN h.next_manufacture_cost + h.material_cost ELSE h.manufacture_cost + h.material_cost END AS 発注unit_price ,h.manufacture_cost_type ,CASE WHEN h.next_manufacture_cost <> 0 THEN h.next_manufacture_cost ELSE h.manufacture_cost END AS manufacture_cost ,h.material_cost_type ,h.material_cost ,0 AS 詳細version_no ,e.is_corrected_material_cost ,CASE WHEN COALESCE(e.is_corrected_material_cost,false) = true THEN COALESCE(e.material_cost_correction_amount,0) ELSE 0 END AS material_cost_correction_amount ,0 AS next_manufacture_cost FROM t_incoming_orders AS a LEFT OUTER JOIN m_customers AS b ON b.customer_code = a.customer_code LEFT OUTER JOIN m_employees AS c ON c.employee_code = a.manager_code LEFT OUTER JOIN m_stocks AS d ON d.part_no = a.part_no AND d.engineering_change_no = a.engineering_change_no LEFT OUTER JOIN m_parts AS e ON e.part_no = a.part_no LEFT OUTER JOIN m_material_basic_unit_prices AS f ON f.material_code = e.material_code AND CURRENT_DATE BETWEEN f.apply_start_DATE AND f.apply_end_DATE CROSS JOIN t_production_plans AS g INNER JOIN t_production_plan_details AS h ON h.management_no = g.management_no LEFT OUTER JOIN m_suppliers AS i ON i.supplier_code = h.supplier_code LEFT OUTER JOIN m_processes AS j ON j.process_code = h.process_code WHERE a.management_no = CAST(? AS INT) AND g.management_no = CAST(? AS INT) ORDER BY h.process_sort_no


