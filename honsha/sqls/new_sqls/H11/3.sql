-- SQL_GET_HISTORY_LIST
SELECT a.management_no ,a.incoming_order_no ,a.branch_no ,CASE a.incoming_order_type WHEN '1' THEN '先行手配' WHEN '3' THEN '受注' ELSE '' END AS incoming_order_type ,a.part_no ,a.engineering_change_no ,b.registration_DATE AS 計画作成日 ,b.production_quantity ,c.発注unit_price合計 ,d.supplier_code ,COALESCE(e.supplier_abbreviation,'') ,d.process_code ,COALESCE(f.process_abbreviation,'') FROM t_incoming_orders AS a INNER JOIN t_production_plans AS b ON b.management_no = a.management_no INNER JOIN ( SELECT management_no, SUM(manufacture_cost + material_cost) AS 発注unit_price合計 FROM t_production_plan_details GROUP BY management_no ) AS c ON c.management_no = b.management_no INNER JOIN t_production_plan_details AS d ON d.management_no = b.management_no AND process_sort_no = 1 LEFT OUTER JOIN m_suppliers AS e ON e.supplier_code = d.supplier_code LEFT OUTER JOIN m_processes AS f ON f.process_code = d.process_code WHERE a.part_no = ? AND a.incoming_order_type IN ('1','3') ORDER BY b.registration_DATE DESC, a.incoming_order_no


