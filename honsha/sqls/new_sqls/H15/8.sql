-- SQL_REPORT_SYUTSURYOKU
SELECT a.management_no,b.process_sort_no,b.supplier_code,COALESCE(d.supplier_name,'') AS supplier_name,CURRENT_DATE AS placing_order_DATE,b.deadline,c.part_no,c.engineering_change_no,c.part_name,c.incoming_order_no,c.branch_no,b.process_code,COALESCE(e.process_name,'') AS process_name,COALESCE(g.supplier_name,'') AS 前工程supplier_name,f.deadline AS 前工程deadline,CASE WHEN h.supplier_code IS NULL THEN '古河（本社）' ELSE COALESCE(i.supplier_name,'') END AS 次工程supplier_name,0 AS placing_order_no,a.production_quantity AS placing_order_quantity,c.unit,CASE WHEN b.manufacture_cost_type = true OR b.material_cost_type = true THEN 0.00 ELSE b.manufacture_cost + b.material_cost END AS 発注unit_price ,CASE WHEN b.manufacture_cost_type = true OR b.material_cost_type = true THEN 0 ELSE CAST(trunc((b.manufacture_cost + b.material_cost) * a.production_quantity,0) as BIGINT) END AS 発注price ,c.placing_order_remarks_1,c.placing_order_remarks_2,COALESCE(k.employee_name,'') AS manager_name,CASE WHEN l.part_no IS NULL THEN '0' ELSE '1' END AS 管理マーク,CASE WHEN c.incoming_order_type <> '4' THEN '0' ELSE '1' END AS 再納マーク,CASE c.redelivery_type WHEN '1' THEN '不合格選別依頼' WHEN '2' THEN '不合格再処理' WHEN '3' THEN '不合格再製造' ELSE '' END AS 再納マーク種類 ,CASE WHEN h.supplier_code IS NULL THEN 1 ELSE 0 END AS final_process_type,b.material_cost FROM t_production_plans AS a INNER JOIN t_production_plan_details AS b ON b.management_no = a.management_no INNER JOIN t_incoming_orders AS c ON c.management_no = a.management_no LEFT OUTER JOIN m_suppliers AS d ON d.supplier_code = b.supplier_code LEFT OUTER JOIN m_processes AS e ON e.process_code = b.process_code LEFT OUTER JOIN t_production_plan_details AS f ON f.management_no = b.management_no AND f.process_sort_no = (b.process_sort_no - 1) LEFT OUTER JOIN m_suppliers AS g ON g.supplier_code = f.supplier_code LEFT OUTER JOIN t_production_plan_details AS h ON h.management_no = b.management_no AND h.process_sort_no = (b.process_sort_no + 1) LEFT OUTER JOIN m_suppliers AS i ON i.supplier_code = h.supplier_code LEFT OUTER JOIN m_employees AS k ON k.employee_code = c.manager_code LEFT OUTER JOIN ( SELECT DISTINCT part_no FROM t_drawings WHERE drawing_type = '1' ) AS l ON l.part_no = c.part_no WHERE a.management_no = CAST(? AS INT) ORDER BY b.management_no, b.process_sort_no


