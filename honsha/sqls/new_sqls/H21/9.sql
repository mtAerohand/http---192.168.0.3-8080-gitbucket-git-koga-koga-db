-- SQL_GET_NEW_CORE
SELECT a.management_no ,a.partial_delivery_no ,b.incoming_order_no ,b.branch_no ,b.customer_code ,COALESCE(c.customer_name,'') AS customer_name ,CASE WHEN b.customer_code = '1' THEN '1' ELSE '0' END AS 得意先区分 ,b.part_no ,b.engineering_change_no ,b.part_name ,b.customer_part_no ,b.manager_code ,COALESCE(d.employee_name,'') AS manager_name ,CASE b.incoming_order_data_type WHEN 'A' THEN COALESCE(e.management_no,'') WHEN 'K' THEN COALESCE(f.management_no,'') WHEN 'C' THEN COALESCE(f.management_no,'') ELSE '' END AS management_no ,b.biller ,CASE b.incoming_order_data_type WHEN 'A' THEN COALESCE(e.kogo,'') WHEN 'K' THEN COALESCE(f.kogo,'') WHEN 'C' THEN COALESCE(f.kogo,'') ELSE '' END AS kogo ,CASE b.incoming_order_data_type WHEN 'A' THEN COALESCE(e.bin,'') WHEN 'K' THEN COALESCE(f.bin,'') WHEN 'C' THEN COALESCE(f.bin,'') ELSE '' END AS bin ,b.incoming_order_DATE ,b.deadline ,a.delivery_DATE ,b.incoming_order_quantity ,a.request_quantity ,CASE a.delivery_form_type WHEN '1' THEN '完納' WHEN '2' THEN '打切り' WHEN '3' THEN '分納' WHEN '4' THEN '過剰納入' WHEN '11' THEN 'END' WHEN '12' THEN 'STP' WHEN '13' THEN 'ING' ELSE '' END AS 納入形態 ,a.request_quantity AS 納quantity ,b.unit ,b.unit_price ,CASE COALESCE(c.price_round_type,'1') WHEN '1' THEN CAST(FLOOR(b.unit_price * a.request_quantity) as BIGINT) WHEN '2' THEN CAST(CEIL(b.unit_price * a.request_quantity) as BIGINT) ELSE CAST(ROUND(b.unit_price * a.request_quantity, 0) as BIGINT) END AS price ,b.next_process_name ,a.delivery_place_name ,'' AS item_tag_remarks ,b.delivery_remarks_1 ,b.delivery_remarks_2 ,'1' AS packing_unit ,1 AS version_no ,a.delivery_form_type ,NULL AS seq_no ,NULL AS quantity ,NULL AS packing_quantity FROM t_test_and_ship_requests AS a INNER JOIN t_incoming_orders AS b ON b.management_no = a.management_no LEFT OUTER JOIN m_customers AS c ON c.customer_code = b.customer_code LEFT OUTER JOIN m_employees AS d ON d.employee_code = b.manager_code LEFT OUTER JOIN t_kobai_juchu AS e ON e.report_no = b.incoming_order_barcode_no LEFT OUTER JOIN t_kogo AS f ON f.issue_INT AUTO_INCREMENT_no = b.incoming_order_barcode_no WHERE a.management_no = CAST(? as INT) AND a.partial_delivery_no = CAST(? as INT)


