-- SQL_NOUHINSYO
SELECT a.management_no,a.partial_delivery_no,b.customer_code,COALESCE(c.zip_code_1,'') AS zip_code_1,COALESCE(c.zip_code_2,'') AS zip_code_2,COALESCE(c.address_1,'') AS address_1,COALESCE(c.address_2,'') AS address_2,COALESCE(c.customer_name,'') AS customer_name,b.incoming_order_no,b.incoming_order_DATE,b.deadline,a.delivery_DATE,CASE d.ship_service_type WHEN '1' THEN '赤帽便' WHEN '2' THEN 'ヤマト便' WHEN '3' THEN '佐川急便' WHEN '4' THEN '営業届け' WHEN '5' THEN 'その他' ELSE '' END AS 出荷便,CASE WHEN COALESCE(c.closing_DATE_type,false) = true THEN '末日' ELSE COALESCE(c.closing_DATE,'') || '日' END AS closing_DATE ,b.part_no,b.engineering_change_no,b.part_name,b.incoming_order_quantity,a.request_quantity AS 納quantity,b.unit,CASE a.delivery_form_type WHEN '1' THEN '完納' WHEN '2' THEN '打切り' WHEN '3' THEN '分納' ELSE '過剰納入' END AS 納入形態,a.unit_price,a.price,d.delivery_place_name,a.remarks_1,a.remarks_2,e.quantity,e.packing_quantity FROM t_sales AS a INNER JOIN t_incoming_orders AS b ON b.management_no = a.management_no LEFT OUTER JOIN m_customers AS c ON c.customer_code = b.customer_code INNER JOIN t_test_and_ship_requests AS d ON d.management_no = a.management_no AND d.partial_delivery_no = a.partial_delivery_no INNER JOIN t_sales_details AS e ON e.management_no = a.management_no AND e.partial_delivery_no = a.partial_delivery_no WHERE a.management_no = ? AND a.partial_delivery_no = ? ORDER BY e.seq_no


