-- SQL_GENPINHYOU_ZISYA
SELECT a.management_no ,a.partial_delivery_no ,a.delivery_DATE ,b.incoming_order_no ,CASE WHEN b.customer_part_no = '' THEN b.part_no ELSE b.customer_part_no END AS part_no ,b.engineering_change_no ,b.part_name ,c.delivery_place_name ,a.item_tag_remarks ,e.quantity計 ,e.packing_quantity計 ,CASE WHEN a.packing_unit = '1' THEN '箱' ELSE '袋' END AS packing_unit ,d.quantity ,d.packing_quantity FROM t_sales AS a INNER JOIN t_incoming_orders AS b ON b.management_no = a.management_no INNER JOIN t_test_and_ship_requests AS c ON c.management_no = a.management_no AND c.partial_delivery_no = a.partial_delivery_no INNER JOIN t_sales_details AS d ON d.management_no = a.management_no AND d.partial_delivery_no = a.partial_delivery_no INNER JOIN ( SELECT management_no ,partial_delivery_no ,SUM(quantity * packing_quantity) AS quantity計 ,SUM(packing_quantity) AS packing_quantity計 FROM t_sales_details GROUP BY management_no, partial_delivery_no ) AS e ON e.management_no = a.management_no AND e.partial_delivery_no = a.partial_delivery_no WHERE a.management_no = CAST(? as INT) AND a.partial_delivery_no = CAST(? as INT) ORDER BY d.seq_no


